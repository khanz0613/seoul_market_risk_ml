# 🏢 서울 시장 위험도 ML 시스템 사용 가이드

## 📋 시스템 개요
이 시스템은 서울 소상공인의 매출 위험도를 예측하고 위험 중립화 대출 금액을 산출하는 ML 시스템입니다.

## 🚀 시스템 시작하기

### 1. 기본 환경 설정
```bash
# 필요한 패키지 설치
pip install pandas numpy scikit-learn lightgbm prophet statsmodels psutil pyyaml

# 시스템 디렉토리로 이동
cd /Users/khanz/Documents/GitHub/NH/seoul_market_risk_ml
```

### 2. 새로운 비즈니스 위험도 예측하기

#### 방법 1: Python 스크립트 사용
```python
import sys
sys.path.append('/Users/khanz/Documents/GitHub/NH/seoul_market_risk_ml')

from src.models.risk_calculator import RiskCalculator
from src.utils.config_loader import ConfigLoader

# 설정 로드
config = ConfigLoader()

# 위험도 계산기 초기화
risk_calc = RiskCalculator(config)

# 새 비즈니스 데이터 예제
new_business = {
    'business_id': 'NEW_001',
    'business_name': '서울김치찌개',
    'business_type': '음식점',
    'region_id': '11110530',  # 서울 종로구 사직동
    'revenue_history': [12000000, 13500000, 11800000, 14200000, 13100000],  # 최근 5개월 매출
    'location': {
        'district': '종로구',
        'dong': '사직동'
    }
}

# 위험도 계산
risk_result = risk_calc.calculate_comprehensive_risk(new_business)

print(f"🎯 위험도 점수: {risk_result['total_score']:.1f}점")
print(f"📊 위험 등급: {risk_result['risk_level']}")
print(f"💰 권장 대출한도: {risk_result['recommended_loan']:,}원")
```

#### 방법 2: 기존 데이터 일괄 처리
```python
import pandas as pd
from src.orchestrator.main_orchestrator import MainOrchestrator

# 메인 오케스트레이터 초기화
orchestrator = MainOrchestrator()

# CSV 파일에서 데이터 로드 (예시 형식)
businesses_df = pd.read_csv('새로운_비즈니스_데이터.csv')

# 일괄 위험도 계산
results = []
for _, business in businesses_df.iterrows():
    risk_result = orchestrator.process_single_business(business.to_dict())
    results.append(risk_result)

# 결과를 DataFrame으로 변환
results_df = pd.DataFrame(results)
results_df.to_csv('위험도_분석_결과.csv', index=False, encoding='utf-8')
```

### 3. 실시간 예측 서버 실행
```python
# 간단한 Flask 서버 예제
from flask import Flask, request, jsonify
from src.models.risk_calculator import RiskCalculator
from src.utils.config_loader import ConfigLoader

app = Flask(__name__)

# 시스템 초기화
config = ConfigLoader()
risk_calc = RiskCalculator(config)

@app.route('/predict_risk', methods=['POST'])
def predict_risk():
    try:
        business_data = request.json
        result = risk_calc.calculate_comprehensive_risk(business_data)
        return jsonify({
            'success': True,
            'risk_score': result['total_score'],
            'risk_level': result['risk_level'],
            'recommended_loan': result['recommended_loan'],
            'factors': result['factors']
        })
    except Exception as e:
        return jsonify({'success': False, 'error': str(e)})

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=True)
```

## 📊 입력 데이터 형식

### 필수 필드
```json
{
    "business_id": "BUSINESS_001",
    "business_name": "서울김치찌개",
    "business_type": "음식점",  // "음식점", "소매업", "서비스업", "제조업" 등
    "region_id": "11110530",   // 서울 행정동 코드
    "revenue_history": [12000000, 13500000, 11800000, 14200000, 13100000]
}
```

### 선택 필드 (더 정확한 예측)
```json
{
    "location": {
        "district": "종로구",
        "dong": "사직동",
        "address": "서울 종로구 사직로 161"
    },
    "business_details": {
        "opening_date": "2020-03-15",
        "employee_count": 3,
        "store_size": 50,  // 평수
        "monthly_rent": 3000000
    }
}
```

## 📈 출력 결과 이해하기

### 위험도 점수 해석
- **0-20점**: 🟢 안전 (낮은 위험)
- **21-40점**: 🟡 주의 (보통 위험)  
- **41-60점**: 🟠 경계 (높은 위험)
- **61-80점**: 🔴 위험 (매우 높은 위험)
- **81-100점**: ⚫ 매우위험 (극도로 높은 위험)

### 주요 위험 요인
```json
{
    "factors": {
        "revenue_change": -15.2,    // 매출 변화율 (%)
        "volatility": 12.8,         // 매출 변동성 (%)
        "trend": -0.05,             // 매출 트렌드
        "seasonal_deviation": 8.3,   // 계절성 편차
        "industry_comparison": 5.2   // 업종 대비 성과
    },
    "weights": {
        "revenue_change": 0.30,     // 각 요인별 가중치
        "volatility": 0.20,
        "trend": 0.20,
        "seasonal_deviation": 0.15,
        "industry_comparison": 0.15
    }
}
```

## 🔧 고급 사용법

### 1. 모델 재훈련
```python
from src.training.model_trainer import ModelTrainer

# 새로운 데이터로 모델 재훈련
trainer = ModelTrainer()
trainer.train_all_models()  # 전체 모델 재훈련
trainer.train_regional_models()  # 지역 모델만 재훈련
```

### 2. 성능 모니터링
```python
from src.evaluation.model_evaluator import ModelEvaluator

evaluator = ModelEvaluator()
performance_report = evaluator.evaluate_all_models()
print(performance_report)
```

### 3. 시스템 벤치마크
```python
# 시스템 성능 확인
python src/benchmarks/system_benchmark.py
```

## 📝 실제 사용 예시

### 케이스 1: 신규 음식점 대출 심사
```python
new_restaurant = {
    'business_id': 'REST_001',
    'business_name': '홍대떡볶이',
    'business_type': '음식점',
    'region_id': '11170520',  # 홍대 지역
    'revenue_history': [8000000, 9200000, 8500000, 10100000, 9300000]
}

result = risk_calc.calculate_comprehensive_risk(new_restaurant)
# 결과: 위험도 25점 (주의), 권장 대출한도 23,250,000원
```

### 케이스 2: 기존 소매업 재평가
```python
existing_retail = {
    'business_id': 'RETAIL_005',
    'business_name': '편의점24',
    'business_type': '소매업',
    'region_id': '11140510',  # 중구 지역
    'revenue_history': [15000000, 14200000, 13800000, 13500000, 13000000]
}

result = risk_calc.calculate_comprehensive_risk(existing_retail)
# 결과: 위험도 45점 (경계), 권장 대출한도 39,000,000원
```

## ⚠️ 주의사항

1. **데이터 품질**: 매출 데이터는 최소 3개월 이상 필요
2. **지역 코드**: 정확한 서울시 행정동 코드 사용 필수
3. **업종 분류**: 시스템에서 지원하는 업종 카테고리 확인
4. **주기적 재훈련**: 분기별로 새로운 데이터로 모델 업데이트 권장

## 🆘 문제 해결

### 자주 발생하는 오류
```bash
# ModuleNotFoundError 해결
pip install -r requirements.txt

# 메모리 부족 시
# config/config.yaml에서 batch_size 조정

# 모델 파일 없음 오류
python src/training/model_trainer.py  # 모델 재생성
```

## 📞 지원

시스템 관련 문의나 기술 지원이 필요하시면:
- 설정 파일: `config/config.yaml`
- 로그 파일: `logs/seoul_market_risk.log`
- 문서: `claudedocs/` 디렉토리 참조